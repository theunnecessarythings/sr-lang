package test_std_mem

testing :: import "std/testing"
mem :: import "std/mem"

test "std_mem: eql" {
    a_arr := [1, 2, 3]
    b_arr := [1, 2, 3]
    c_arr := [1, 2, 4]
    
    a := a_arr[0..3]
    b := b_arr[0..3]
    c := c_arr[0..3]
    
    if !mem.eql(i32, a, b) { return Error.Fail }
    if mem.eql(i32, a, c) { return Error.Fail }
}

test "std_mem: index_of" {
    haystack_arr := [1, 2, 3, 4, 5]
    needle_arr := [3, 4]
    not_found_arr := [5, 6]
    
    haystack := haystack_arr[0..5]
    needle := needle_arr[0..2]
    not_found := not_found_arr[0..2]
    
    idx := mem.index_of(i32, haystack, needle)
    if idx == null { return Error.Fail }
    if idx? != 2 { return Error.Fail }
    
    if mem.index_of(i32, haystack, not_found) != null { return Error.Fail }
}

test "std_mem: index_of_scalar" {
    arr_arr := [10, 20, 30]
    arr := arr_arr[0..3]
    
    idx := mem.index_of_scalar(i32, arr, 20)
    if idx == null { return Error.Fail }
    if idx? != 1 { return Error.Fail }
    
    if mem.index_of_scalar(i32, arr, 40) != null { return Error.Fail }
}

test "std_mem: last_index_of_scalar" {
    arr_arr := [1, 2, 1, 3]
    arr := arr_arr[0..4]
    
    idx := mem.last_index_of_scalar(i32, arr, 1)
    if idx == null { return Error.Fail }
    if idx? != 2 { return Error.Fail }
}

test "std_mem: starts_with/ends_with" {
    arr_arr := [1, 2, 3, 4]
    prefix_arr := [1, 2]
    suffix_arr := [3, 4]
    bad_arr := [2, 3]
    
    arr := arr_arr[0..4]
    prefix := prefix_arr[0..2]
    suffix := suffix_arr[0..2]
    bad := bad_arr[0..2]
    
    if !mem.starts_with(i32, arr, prefix) { return Error.Fail }
    if !mem.ends_with(i32, arr, suffix) { return Error.Fail }
    if mem.starts_with(i32, arr, bad) { return Error.Fail }
}

test "std_mem: count" {
    arr_arr := [1, 2, 1, 3, 1]
    arr := arr_arr[0..5]
    cnt := mem.count(i32, arr, 1)
    if cnt != 3 { return Error.Fail }
}

test "std_mem: reverse" {
    arr: [5]i32 = [1, 2, 3, 4, 5]
    slice := arr[0..5]
    mem.reverse(i32, slice)
    
    if slice[0] != 5 { return Error.Fail }
    if slice[1] != 4 { return Error.Fail }
    if slice[4] != 1 { return Error.Fail }
}

test "std_mem: align_forward" {
    if mem.align_forward(0, 4) != 0 { return Error.Fail }
    if mem.align_forward(1, 4) != 4 { return Error.Fail }
    if mem.align_forward(3, 4) != 4 { return Error.Fail }
    if mem.align_forward(4, 4) != 4 { return Error.Fail }
    if mem.align_forward(5, 4) != 8 { return Error.Fail }
}

test "std_mem: is_aligned" {
    if !mem.is_aligned(0, 4) { return Error.Fail }
    if !mem.is_aligned(4, 4) { return Error.Fail }
    if mem.is_aligned(1, 4) { return Error.Fail }
}
